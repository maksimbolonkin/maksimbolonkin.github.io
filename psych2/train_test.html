<html>
    <head>
        <title>Пробная сессия</title>
        <script lang="javascript">
            var q_id = 0;
            var totalImages = 3;
            var primingTime = 3000;
            var stimulusTime = 300;

            //  переменные для замерения времени и результатов
            var startTime = 0;
            var reactionTimes = [];
            var answerLog = [];

            var waitArrow = false;
            var waitSpace = false;

            var timer = null;

            function preparePage(){
                document.onkeydown = keyIsDown;
                document.getElementById('results').style.display = "none";
                whiteScreenBetweenSeries();
            }

            function startPriming(){
                document.getElementById("centralImage").src = "./images/test0/P"+q_id.toString()+".jpg";
                document.getElementById('centralImage').style.display = "block";
                timer = window.setTimeout(startStimulus, primingTime);
            }
            function startStimulus(){
                document.getElementById("centralImage").src = "./images/test0/S"+q_id.toString()+".jpg";
                // save current time
                var d = new Date();
                startTime = d.getTime();
                waitArrow = true;
                // start gray screen 
                timer = window.setTimeout(startNoise, stimulusTime);
            }

            function startNoise(){
                document.getElementById("centralImage").src = "./images/white_noise.png";
            }

            function keyIsDown(event){
                // if waiting hasn't started (stimulus isn't presented) or white screen isn't shown
                if(!waitArrow && !waitSpace){
                    return;
                }

                var key = event.keyCode;

                if(waitSpace){
                    if(key==32){
                        //space
                        waitSpace = false;
                        document.getElementById('instruction').style.display = "none";
                        startPriming();
                    }
                    else{
                        // anything else
                        return;
                    }
                }

                if(waitArrow){
                    if(key==37){
                        // <=
                        res = 0;
                    }
                    else if(key==39){
                        // =>
                        res = 1;
                    }
                    else{
                        // anything else
                        return;
                    }
                    // clearing timeout for noise screen if any
                    clearTimeout(timer);
                    // res: 1 for knowing the face, 0 for not knowing the face
                    // save response time
                    waitArrow = false;
                    var d = new Date();
                    reactionTimes.push(d.getTime()-startTime);
                    answerLog.push(res); 
                    whiteScreenBetweenSeries();
                }
            }

            function whiteScreenBetweenSeries(){
                document.getElementById('centralImage').style.display = "none";
                q_id += 1;
                if(q_id > totalImages){
                    displayResults();
                }
                else{
                    // wait till they push space button
                    document.getElementById('instruction').style.display = "block";
                    waitSpace = true;
                    return;
                }
            }

            function displayResults(){
                s = "";
                for(i = 0; i<answerLog.length; i++){
                    if(answerLog[i]==0){
                        s += "НЕ ЗНАЮ (ЛЕВО)";
                    }
                    else{
                        s += "ЗНАЮ (ПРАВО)";
                    }
                    if(i < answerLog.length-1){
                        s += ", ";
                    }
                }
                document.getElementById('answers').innerText = s;
                document.getElementById('results').style.display = "block";
            }
        </script>
    </head>
    <body onload="preparePage();">
        <center>
            <img id='centralImage' src="./images/white_noise.png" style="height:500px display: none;">
            <br><br>
            <div id="instruction" style="color: gray; font-size: larger;">Нажмите пробел для продолжения</div>
            <div id="results" style="color: gray; font-size: larger;">
                Вы успешно завершили пробный тест. Ваши ответы были:  <span id="answers"></span>.<br><br>
                <a href="./info.html">Дальше</a>
            </div>
        </center>
    </body>
</html>