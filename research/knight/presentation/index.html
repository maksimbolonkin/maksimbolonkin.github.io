<html>
<head>
<title>Search within the video</title>
<script>

	function readTextFileNoSplit(fname)
	{
		var rawFile = new XMLHttpRequest();
    		rawFile.open("GET", fname, false);
		var allText;
   		rawFile.onreadystatechange = function ()
    		{
        		if(rawFile.readyState === 4)
        		{
            			if(rawFile.status === 200 || rawFile.status == 0)
            			{
                			allText = rawFile.responseText;				
				}
            		}
       		}
		rawFile.send(null);
		return allText;
	}
	
	function clearPage()
	{
		var imgs = document.getElementsByTagName('img');
		for(var i=0; i<imgs.length; i++)
		{
			imgs[i].style.visibility = "hidden";
		}

		var vids = document.getElementsByTagName('video');
		for(var i=0; i<vids.length; i++)
		{
			vids[i].style.display = "none";
		}
	}

	function preparePage()
	{
		populateDropDownBox();
		clearPage();
	}

	function populateDropDownBox()
	{
		allText = readTextFileNoSplit("./queries.lst")
		dropdownbox = document.getElementById("query");

		var lines = allText.split('\n');
		for(var i = 0; i < lines.length-1; i++)
		{
		   var opt = document.createElement("option");
		   opt.value= i+1;
		   opt.innerHTML = lines[i]; // whatever property it has
		   //opt.setAttribute('value', i+1);
    		   //opt.appendChild(document.createTextNode(lines[i]));

		   // then append it to the select element
		   dropdownbox.appendChild(opt);
		}
	}

	function ImageExist(url) 
	{
	   var img = new Image();
	   img.src = url;
	   return img.height != 0;
	}

        function onClickHandler(){
		clearPage();
		
		var vids = document.getElementsByTagName('video');
		var imgs = document.getElementsByTagName('img');
		
		q_id = document.getElementById("query").value;
		if(q_id == 0)
			return;

		// loading images
		var i=1;
		var im_count = 0;
		while(im_count < 10)
		{
			
			im_path = "query_img/".concat(q_id).concat("/").concat(i-1).concat(".jpg");
			//if(ImageExist(im_path))
			//{
				imgs[im_count].src = im_path;
				imgs[im_count].style.visibility = "visible";
				im_count++;
			//}
			i++;
			
		}

		//load search results
		var allUrls = readTextFileNoSplit("query_results/query_result_".concat(q_id).concat(".txt"));
		var urls = allUrls.split('\n');
		for(var line = 0; line < urls.length-1; line++){
		      //console.log(lines[line]);
			vids[line].src = urls[line];
			vids[line].load();
			vids[line].style.display = "inline";
		}

		// load GT video
		var gtAllUrls = readTextFileNoSplit("ground_truth_urls.txt");
		var gtUrls = gtAllUrls.split('\n');
		gt_v_id = vids.length-1;
		vids[gt_v_id].src = gtUrls[q_id-1];
		vids[gt_v_id].load();
		vids[gt_v_id].style.display = "inline";
        }
        
</script>

</head>
<body onLoad="preparePage();">
<center>
 <select id="query">
  <option value="0">...</option>
</select>
 <button type="button" onClick="onClickHandler();">Search</button> <br><br>
<table border="1" width=85%>
<tr><td colspan=5>Top-10 images corresponding to the query</td></tr>
<tr><td>
<table halign="center">
<tr><td width=20%><img src="query_img/1/0.jpg" width="90%" height="90%" style="visibility: none;"></td>
<td width=20%><img src="query_img/1/0.jpg" width="90%" height="90%" style="visibility: none;"></td>
<td width=20%><img src="query_img/1/0.jpg" width="90%" height="90%" style="visibility: none;"></td>
<td width=20%><img src="query_img/1/0.jpg" width="90%" height="90%" style="visibility: none;"></td>
<td width=20%><img src="query_img/1/0.jpg" width="90%" height="90%" style="visibility: none;"></td>
</tr>
<tr><td width=20%><img src="query_img/1/0.jpg" width="90%" height="90%" style="visibility: none;"></td>
<td width=20%><img src="query_img/1/0.jpg" width="90%" height="90%" style="visibility: none;"></td>
<td width=20%><img src="query_img/1/0.jpg" width="90%" height="90%" style="visibility: none;"></td>
<td width=20%><img src="query_img/1/0.jpg" width="90%" height="90%" style="visibility: none;"></td>
<td width=20%><img src="query_img/1/0.jpg" width="90%" height="90%" style="visibility: none;"></td></tr>
</table>
</td></tr>
<tr><td>
<table width=100%>
<tr><td width = 50%>Search result</td><td>Ground truth</td></tr>
<tr><td>
<video id="myVideo" width="360" controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video>
<br><br>
<video id="myVideo" width="360"  controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video>
<br><br>
<video id="myVideo" width="360"  controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video>
<br><br>
<video id="myVideo" width="360"  controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video>
<br><br>
<video id="myVideo" width="360"  controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video>
<br><br>
<video id="myVideo" width="360"  controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video>
<br><br>
<video id="myVideo" width="360"  controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video>
<br><br>
<video id="myVideo" width="360"  controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video>
<br><br>
<video id="myVideo" width="360"  controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video>
<br><br>
<video id="myVideo" width="360"  controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video>
</td>


<td valign="top"><video id="myVideo" width="360"  controls="controls" muted id="q1" hidden> <source src="https://archive.org/download/AmericanFarmer/AmericanFarmer.mp4?start=686&end=689" type="video/mp4"></video></td></tr>
</table>

</td></tr>
</table>

</center>
</body>
</html>
